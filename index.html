<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA DE MANUTENÇÃO - COMANDO CENTRAL</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
        }
    }
    </script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');

        /* Estilos Globais Dinâmicos */
        .layout-gaming {
            font-family: 'Rajdhani', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }

        .layout-traditional {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: #0f172a;
        }

        /* Estilos Gaming */
        .neon-border {
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.3), inset 0 0 5px rgba(34, 211, 238, 0.2);
            border: 1px solid rgba(34, 211, 238, 0.5);
        }

        .neon-text-blue {
            text-shadow: 0 0 8px rgba(34, 211, 238, 0.8);
        }

        .game-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 1);
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%);
        }

        .btn-game {
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0% 30%);
            transition: all 0.2s ease;
        }

        .completed-row-gaming {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.02) 100%) !important;
            border-left: 4px solid #10b981 !important;
        }

        /* Estilos Tradicionais */
        .trad-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .completed-row-traditional {
            background-color: #f0fdf4 !important;
            border-left: 4px solid #22c55e !important;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #64748b; border-radius: 10px; }

        @media print {
            body { background: white !important; color: black !important; }
            .print-hidden { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        window.__firebase_config = JSON.stringify({
            apiKey: "AIzaSyC2sCd7LLsDIgtsyKWrz2aaHmBojglK7pg",
            authDomain: "controle-de-manutencoes-49274.firebaseapp.com",
            projectId: "controle-de-manutencoes-49274",
            storageBucket: "controle-de-manutencoes-49274.firebasestorage.app",
            messagingSenderId: "32715522228",
            appId: "1:32715522228:web:65637da97de422c2f497e1",
            measurementId: "G-T6TS6Y6NT5"
        });
        window.__app_id = "controle-pedidos-game-v1";
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Plus, Search, Edit2, Trash2, Save, X, FileText, Building2, 
          DollarSign, LayoutDashboard, Filter, CheckCircle2, Clock, 
          XCircle, Package, Tag, User, Truck, Briefcase, Wrench, 
          Box, Send, MessageSquare, CheckSquare, Square, Printer, 
          Download, Lock, LogOut, AlertTriangle, ShieldCheck, Zap, 
          Target, BarChart3, Terminal, Monitor, Laptop
        } from 'lucide-react';

        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, serverTimestamp, query } from 'firebase/firestore';

        const firebaseConfig = JSON.parse(window.__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = window.__app_id;

        const LISTA_MANTENEDORAS = ["AESMS", "ACESC", "AEI", "AESA", "AESGF", "AESJC", "AESPI", "APESU", "ASCEC", "ASPER", "ASSOBES", "AVIES", "BRICOR", "CESC", "CIESPT", "DI GENIO", "SINEC", "SUPERO", "SUPERO EC", "ASSUPERO", "ECEL"].sort();
        const LISTA_FILIAIS = ["Alphaville", "Anchieta", "Araçatuba", "Araraquara", "Assis", "Bacelar", "Bauru", "Brasilia", "Campinas", "Cancioneiro", "Cid. Universitária", "Goiania Flamboyant", "Jundiai", "Limeira", "Manaus", "Marques S. Vicente", "Norte", "Paraiso", "Paulista", "Paz", "Paz / Henri Dunant", "Pinheiros", "Ribeirão Preto", "Santos", "São José do Rio Pardo", "São José dos Campos", "Sorocaba", "Taquari", "Tatuape", "Vergueiro", "São Jose do Rio Preto"].sort();

        function App() {
          const [user, setUser] = useState(null);
          const [orders, setOrders] = useState([]);
          const [loading, setLoading] = useState(true);
          const [view, setView] = useState('list');
          const [editingOrder, setEditingOrder] = useState(null);
          const [currentUserProfile, setCurrentUserProfile] = useState(null); 
          const [showReport, setShowReport] = useState(false); 
          const [passwordModalOpen, setPasswordModalOpen] = useState(false);
          const [pendingProfile, setPendingProfile] = useState(null);
          const [passwordInput, setPasswordInput] = useState('');
          
          // --- CONTROLE DE LAYOUT ---
          const [layoutMode, setLayoutMode] = useState('gaming'); // 'gaming' ou 'traditional'

          useEffect(() => {
            signInAnonymously(auth).catch(console.error);
            const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
              setUser(currentUser);
              if(currentUser) setLoading(false);
            });
            return () => unsubscribe();
          }, []);

          useEffect(() => {
            if (!user || !db) return;
            const q = query(collection(db, 'artifacts', appId, 'users', user.uid, 'orders'));
            const unsubscribe = onSnapshot(q, (snapshot) => {
                const loadedOrders = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data(),
                  createdAt: doc.data().createdAt?.toDate() || new Date()
                }));
                loadedOrders.sort((a, b) => b.createdAt - a.createdAt);
                setOrders(loadedOrders);
              }, () => {}
            );
            return () => unsubscribe();
          }, [user]);

          const handlePasswordSubmit = (e) => {
            e.preventDefault();
            let valid = (pendingProfile === 'NELSON' && passwordInput === 'BIA123') || (pendingProfile === 'JORDAN' && passwordInput === '1234');
            if (valid) {
                setCurrentUserProfile(pendingProfile);
                setPasswordModalOpen(false);
                setPasswordInput('');
            } else {
                alert("ACESSO NEGADO: Senha Inválida");
                setPasswordInput('');
            }
          };

          const handleSave = async (orderData) => {
            try {
              const collectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'orders');
              const dataToSave = { 
                ...orderData, 
                userProfile: orderData.id ? (orderData.userProfile || 'JORDAN') : currentUserProfile 
              };
              if (editingOrder) {
                await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'orders', editingOrder.id), { ...dataToSave, updatedAt: serverTimestamp() });
              } else {
                await addDoc(collectionRef, { ...dataToSave, createdAt: serverTimestamp(), completed: false });
              }
              setView('list');
              setEditingOrder(null);
            } catch (error) { alert("Erro ao salvar no banco de dados."); }
          };

          if (loading) return (
            <div className="min-h-screen flex flex-col items-center justify-center bg-slate-950">
                <div className="w-64 h-2 bg-slate-800 rounded-full overflow-hidden mb-4 neon-border">
                    <div className="h-full bg-cyan-400 animate-[pulse_1s_infinite] shadow-[0_0_10px_#22d3ee]"></div>
                </div>
                <p className="text-cyan-400 font-bold tracking-widest animate-pulse uppercase">Carregando Sistema...</p>
            </div>
          );

          return (
            <div className={`min-h-screen pb-10 transition-colors duration-500 ${layoutMode === 'gaming' ? 'layout-gaming' : 'layout-traditional'}`}>
              {/* MODAL DE LOGIN */}
              {passwordModalOpen && (
                <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-md p-4">
                  <div className={`${layoutMode === 'gaming' ? 'game-card p-1' : 'bg-white rounded-xl shadow-2xl overflow-hidden'} w-full max-w-sm`}>
                    <div className={`${layoutMode === 'gaming' ? 'bg-slate-900 border-b border-cyan-500/30 text-cyan-400' : 'bg-slate-100 border-b text-slate-800'} p-4 flex items-center justify-center gap-2`}>
                      <ShieldCheck size={24} />
                      <h3 className="font-bold text-xl uppercase tracking-tighter">Identifique-se: {pendingProfile}</h3>
                    </div>
                    <form onSubmit={handlePasswordSubmit} className="p-6">
                      <input 
                        type="password" autoFocus placeholder="SENHA DE ACESSO"
                        className={`w-full px-4 py-3 rounded-lg mb-6 text-center text-xl tracking-[0.5em] outline-none ${
                            layoutMode === 'gaming' 
                            ? 'bg-slate-950 border border-slate-700 text-white focus:ring-2 focus:ring-cyan-500' 
                            : 'bg-white border border-slate-300 text-slate-900 focus:ring-2 focus:ring-blue-500'
                        }`}
                        value={passwordInput} onChange={e => setPasswordInput(e.target.value)}
                      />
                      <div className="flex gap-3">
                        <button type="button" onClick={() => setPasswordModalOpen(false)} className="flex-1 py-3 text-slate-500 font-bold uppercase hover:text-slate-400 transition-colors">Cancelar</button>
                        <button type="submit" className={`flex-1 py-3 font-black uppercase rounded-lg shadow-lg ${
                            layoutMode === 'gaming' ? 'bg-cyan-600 text-white btn-game' : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}>Acessar</button>
                      </div>
                    </form>
                  </div>
                </div>
              )}

              {/* HUD DO CABEÇALHO */}
              <header className={`sticky top-0 z-10 px-4 py-2 backdrop-blur-md print:hidden border-b transition-all ${
                layoutMode === 'gaming' 
                ? 'bg-slate-900/80 border-cyan-500/20' 
                : 'bg-white/90 border-slate-200'
              }`}>
                <div className="max-w-6xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
                  <div className="flex items-center gap-3">
                    <div className={`p-2 rounded-lg border ${
                        layoutMode === 'gaming' ? 'bg-cyan-500/10 border-cyan-500/50 text-cyan-400' : 'bg-blue-50 border-blue-200 text-blue-600'
                    }`}>
                        <Terminal size={24} />
                    </div>
                    <div>
                        <h1 className={`text-xl font-black tracking-tighter uppercase leading-none ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>
                            Centro de Comando
                        </h1>
                        <p className={`text-[10px] font-bold tracking-[0.2em] uppercase ${layoutMode === 'gaming' ? 'text-cyan-400/70' : 'text-slate-400'}`}>
                            {layoutMode === 'gaming' ? 'SISTEMA v2.0 // CORE PRINCIPAL' : 'Gestão de Manutenções Internas'}
                        </p>
                    </div>
                  </div>

                  <div className="flex items-center gap-4">
                    {/* SELETOR DE LAYOUT */}
                    <button 
                        onClick={() => setLayoutMode(prev => prev === 'gaming' ? 'traditional' : 'gaming')}
                        className={`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-bold transition-all uppercase ${
                            layoutMode === 'gaming' 
                            ? 'bg-slate-800 border-slate-700 text-cyan-400 hover:bg-slate-700' 
                            : 'bg-slate-100 border-slate-200 text-slate-600 hover:bg-slate-200'
                        }`}
                        title="Trocar Interface"
                    >
                        {layoutMode === 'gaming' ? <><Laptop size={14}/> Visual Tradicional</> : <><Monitor size={14}/> Visual Gamming</>}
                    </button>

                    <div className={`flex p-1 rounded-lg border transition-colors ${layoutMode === 'gaming' ? 'bg-slate-800 border-slate-700' : 'bg-slate-100 border-slate-200'}`}>
                      {['JORDAN', 'NELSON'].map(p => (
                        <button 
                            key={p} 
                            onClick={() => { setPendingProfile(p); setPasswordInput(''); setPasswordModalOpen(true); }} 
                            className={`px-4 py-1.5 rounded-md text-xs font-black transition-all ${
                                currentUserProfile === p 
                                ? (layoutMode === 'gaming' ? 'bg-cyan-500 text-slate-950 shadow-[0_0_10px_#22d3ee]' : 'bg-white text-blue-600 shadow-sm border border-slate-100') 
                                : 'text-slate-500 hover:text-slate-400'
                            }`}
                        >
                            {p === currentUserProfile && layoutMode === 'gaming' ? <span className="flex items-center gap-1"><Zap size={12}/> {p}</span> : p}
                        </button>
                      ))}
                    </div>
                    {currentUserProfile && (
                      <div className={`flex items-center gap-2 border-l pl-4 ${layoutMode === 'gaming' ? 'border-slate-700' : 'border-slate-200'}`}>
                        <button onClick={() => setShowReport(true)} className={`p-2 rounded-lg border transition-colors ${
                            layoutMode === 'gaming' ? 'bg-slate-800 border-slate-700 text-cyan-400 hover:bg-slate-700' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50'
                        }`} title="Relatório"><BarChart3 size={20} /></button>
                        <button onClick={() => { setEditingOrder(null); setView('form'); }} className={`px-4 py-2 rounded-lg font-black uppercase text-xs flex items-center gap-2 shadow-lg transition-all ${
                            layoutMode === 'gaming' ? 'bg-emerald-500 text-slate-950 btn-game shadow-emerald-500/20' : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}><Plus size={18}/> Nova Missão</button>
                        <button onClick={() => setCurrentUserProfile(null)} className="p-2 text-slate-400 hover:text-red-500 transition-colors"><LogOut size={20} /></button>
                      </div>
                    )}
                  </div>
                </div>
              </header>

              <main className="max-w-6xl mx-auto p-4 pt-8">
                {!currentUserProfile ? (
                  <div className="text-center py-32 animate-in fade-in zoom-in duration-500">
                    <div className="relative inline-block mb-8">
                        <div className={`absolute inset-0 blur-3xl opacity-10 animate-pulse ${layoutMode === 'gaming' ? 'bg-cyan-500' : 'bg-blue-500'}`}></div>
                        <div className={`${layoutMode === 'gaming' ? 'game-card p-8 neon-border' : 'bg-white rounded-2xl p-10 shadow-xl border border-slate-100'} relative`}>
                            <Lock size={64} className={`${layoutMode === 'gaming' ? 'text-cyan-400 animate-bounce' : 'text-slate-300'} mx-auto mb-4`} />
                            <h2 className={`text-3xl font-black tracking-tighter uppercase ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>Sistema Bloqueado</h2>
                            <p className={`${layoutMode === 'gaming' ? 'text-cyan-400/60' : 'text-slate-500'} font-bold uppercase text-xs tracking-widest mt-2`}>Selecione um operador para prosseguir</p>
                        </div>
                    </div>
                  </div>
                ) : (
                  view === 'list' ? (
                    <DashboardAndList 
                      orders={orders} currentUserProfile={currentUserProfile} layoutMode={layoutMode}
                      onEdit={o => {setEditingOrder(o); setView('form');}}
                      onDelete={id => deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'orders', id))}
                      onToggleComplete={(id, val) => updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'orders', id), { completed: !val })}
                      onUpdateNote={(id, n) => updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'orders', id), { notes: n })}
                      showReport={showReport} onCloseReport={() => setShowReport(false)}
                    />
                  ) : (
                    <OrderForm initialData={editingOrder} currentUserProfile={currentUserProfile} layoutMode={layoutMode} onSave={handleSave} onCancel={() => setView('list')} />
                  )
                )}
              </main>
            </div>
          );
        }

        // --- Componente: Dashboard e Log ---
        function DashboardAndList({ orders, onEdit, onDelete, onUpdateNote, onToggleComplete, currentUserProfile, showReport, onCloseReport, layoutMode }) {
          const [searchTerm, setSearchTerm] = useState('');
          const [filterBranch, setFilterBranch] = useState('');
          const [filterMaintainer, setFilterMaintainer] = useState('');
          const [filterStatus, setFilterStatus] = useState('');
          const [filterSupplier, setFilterSupplier] = useState('');
          const [noteModal, setNoteModal] = useState({ open: false, order: null, text: '' });

          const listaFornecedores = useMemo(() => {
            const fornecedores = orders
              .filter(o => (o.userProfile || 'JORDAN') === currentUserProfile)
              .map(o => o.supplier)
              .filter((val, index, self) => val && self.indexOf(val) === index);
            return fornecedores.sort();
          }, [orders, currentUserProfile]);

          const filteredOrders = useMemo(() => {
            return orders.filter(o => {
              const term = searchTerm.toLowerCase();
              const isCurrentUser = (o.userProfile || 'JORDAN') === currentUserProfile;
              return (
                isCurrentUser &&
                (o.orderNumber?.toLowerCase().includes(term) || o.branch?.toLowerCase().includes(term) || o.supplier?.toLowerCase().includes(term)) &&
                (!filterBranch || o.branch === filterBranch) &&
                (!filterMaintainer || o.maintainer === filterMaintainer) &&
                (!filterStatus || o.status === filterStatus) &&
                (!filterSupplier || o.supplier === filterSupplier)
              );
            });
          }, [orders, searchTerm, filterBranch, filterMaintainer, filterStatus, filterSupplier, currentUserProfile]);

          const stats = useMemo(() => {
            const valid = filteredOrders.filter(o => o.status !== 'reprovado Enio');
            const total = valid.reduce((acc, curr) => acc + parseFloat(curr.value || 0), 0);
            return { count: filteredOrders.length, total };
          }, [filteredOrders]);

          const cardClass = layoutMode === 'gaming' ? 'game-card' : 'trad-card';

          return (
            <div className="space-y-6 animate-in slide-in-from-right-10 duration-500">
              {showReport && <ReportModal orders={filteredOrders} onClose={onCloseReport} layoutMode={layoutMode} />}
              {noteModal.open && (
                <div className="fixed inset-0 z-[80] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm">
                  <div className={`${layoutMode === 'gaming' ? 'game-card' : 'bg-white rounded-xl shadow-2xl border'} w-full max-w-md p-6`}>
                    <h3 className={`font-bold text-lg mb-4 flex items-center gap-2 ${layoutMode === 'gaming' ? 'text-white' : 'text-slate-800'}`}>
                        <MessageSquare size={20} className="text-blue-500"/> Observações
                    </h3>
                    <textarea className={`w-full h-32 p-3 border rounded-lg outline-none resize-none ${
                        layoutMode === 'gaming' ? 'bg-slate-950 border-slate-700 text-white focus:ring-2 focus:ring-cyan-500' : 'bg-slate-50 border-slate-200 text-slate-800 focus:ring-2 focus:ring-blue-500'
                    }`} value={noteModal.text} onChange={e => setNoteModal({...noteModal, text: e.target.value})} placeholder="Digite aqui..." />
                    <div className="flex justify-end gap-2 mt-4">
                      <button onClick={() => setNoteModal({open: false, order: null, text: ''})} className="px-4 py-2 text-slate-500 font-medium">Cancelar</button>
                      <button onClick={() => { onUpdateNote(noteModal.order.id, noteModal.text); setNoteModal({open: false, order: null, text: ''}); }} className={`px-6 py-2 rounded-lg font-bold text-white ${layoutMode === 'gaming' ? 'bg-cyan-600' : 'bg-blue-600'}`}>Salvar</button>
                    </div>
                  </div>
                </div>
              )}

              {/* GADGETS ESTATS */}
              <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div className={`${cardClass} p-4 relative overflow-hidden group`}>
                  <div className={`absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-400'}`}><Target size={48} /></div>
                  <p className={`text-[10px] font-black uppercase tracking-[0.2em] ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>Missões Totais ({currentUserProfile})</p>
                  <p className={`text-4xl font-black ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>{stats.count}</p>
                </div>
                <div className={`${cardClass} p-4 col-span-1 sm:col-span-2 relative overflow-hidden group ${layoutMode === 'gaming' ? 'border-emerald-500/30' : ''}`}>
                  <div className={`absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity ${layoutMode === 'gaming' ? 'text-emerald-400' : 'text-slate-400'}`}><Zap size={48} /></div>
                  <p className={`text-[10px] font-black uppercase tracking-[0.2em] ${layoutMode === 'gaming' ? 'text-emerald-400' : 'text-slate-500'}`}>Recursos Alocados</p>
                  <p className={`text-4xl font-black ${layoutMode === 'gaming' ? 'text-emerald-400 shadow-emerald-500/20' : 'text-emerald-600'}`}>
                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(stats.total)}
                  </p>
                </div>
              </div>

              {/* HUD FILTROS */}
              <div className={`${cardClass} p-4 space-y-4 ${layoutMode === 'gaming' ? 'border-slate-700/50 bg-slate-900/40' : ''}`}>
                <div className="relative">
                    <Search className={`absolute left-3 top-1/2 -translate-y-1/2 ${layoutMode === 'gaming' ? 'text-cyan-400/50' : 'text-slate-400'}`} size={20} />
                    <input 
                        type="text" placeholder={layoutMode === 'gaming' ? "ESCANEANDO LANÇAMENTOS..." : "Pesquisar por número, filial..."} 
                        className={`w-full pl-10 pr-4 py-3 rounded-lg text-sm outline-none transition-all ${
                            layoutMode === 'gaming' 
                            ? 'bg-slate-950/50 border border-cyan-500/20 text-white font-bold tracking-wider uppercase focus:border-cyan-400' 
                            : 'bg-white border border-slate-200 text-slate-800 focus:ring-2 focus:ring-blue-100 focus:border-blue-400'
                        }`} 
                        value={searchTerm} onChange={e => setSearchTerm(e.target.value)} 
                    />
                </div>
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400 focus:border-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterBranch} onChange={e => setFilterBranch(e.target.value)}><option value="">FILIAL: TODAS</option>{LISTA_FILIAIS.map(f => <option key={f} value={f}>{f.toUpperCase()}</option>)}</select>
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400 focus:border-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterMaintainer} onChange={e => setFilterMaintainer(e.target.value)}><option value="">MANTENEDORA</option>{LISTA_MANTENEDORAS.map(m => <option key={m} value={m}>{m}</option>)}</select>
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400 focus:border-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterSupplier} onChange={e => setFilterSupplier(e.target.value)}><option value="">FORNECEDOR</option>{listaFornecedores.map(s => <option key={s} value={s}>{s.toUpperCase()}</option>)}</select>
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400 focus:border-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterStatus} onChange={e => setFilterStatus(e.target.value)}><option value="">STATUS: GERAL</option><option value="aprovado">STATUS: APROVADO</option><option value="enviado">STATUS: ENVIADO</option><option value="ag. aprovação">STATUS: AG. APROVAÇÃO</option><option value="aguardando justificativa">STATUS: AG. JUSTIF.</option><option value="reprovado Enio">STATUS: REPROVADO</option></select>
                </div>
              </div>

              {/* LOG TABELA */}
              <div className={`${cardClass} overflow-hidden`}>
                <div className={`p-3 flex items-center justify-between border-b ${layoutMode === 'gaming' ? 'bg-slate-800/50 border-slate-700 text-white' : 'bg-slate-50 border-slate-100 text-slate-700'}`}>
                    <h3 className="text-xs font-black tracking-[0.3em] flex items-center gap-2 uppercase">
                        <Zap size={14} className={layoutMode === 'gaming' ? "text-yellow-400" : "text-blue-500"}/> 
                        {layoutMode === 'gaming' ? 'Log de Missões Ativas' : 'Lançamentos Recentes'}
                    </h3>
                </div>
                <div className="overflow-x-auto">
                  <table className="w-full text-left text-sm">
                    <thead className={`font-black uppercase text-[10px] tracking-widest border-b ${
                        layoutMode === 'gaming' ? 'bg-slate-900/80 text-cyan-400 border-slate-800' : 'bg-white text-slate-500 border-slate-100'
                    }`}>
                      <tr>
                        <th className="px-6 py-4">Status / Tipo</th>
                        <th className="px-6 py-4">Data / Identidade</th>
                        <th className="px-6 py-4">Fornecedor</th>
                        <th className="px-6 py-4 text-right">Créditos (R$)</th>
                        <th className="px-6 py-4 text-center">Ações</th>
                      </tr>
                    </thead>
                    <tbody className={`divide-y ${layoutMode === 'gaming' ? 'divide-slate-800/50 text-slate-300' : 'divide-slate-100 text-slate-600'}`}>
                      {filteredOrders.length === 0 ? (
                        <tr>
                            <td colSpan="5" className="px-6 py-10 text-center font-bold uppercase tracking-widest text-slate-500">Nenhuma missão encontrada</td>
                        </tr>
                      ) : (
                        filteredOrders.map(o => (
                          <tr key={o.id} className={`transition-all duration-300 ${
                            o.completed 
                            ? (layoutMode === 'gaming' ? 'completed-row-gaming' : 'completed-row-traditional') 
                            : (layoutMode === 'gaming' ? 'hover:bg-slate-800/30' : 'hover:bg-slate-50')
                          }`}>
                            <td className="px-6 py-4">
                              <div className="flex flex-col gap-2 items-start">
                                <span className={`text-[10px] font-black px-3 py-1 rounded-sm uppercase tracking-tighter border ${
                                    o.status === 'aprovado' 
                                    ? 'bg-emerald-500/20 text-emerald-500 border-emerald-500/50' 
                                    : o.status === 'reprovado Enio' ? 'bg-red-500/20 text-red-500 border-red-500/50' : 'bg-amber-500/20 text-amber-500 border-amber-500/50'
                                }`}>{o.status}</span>
                                <span className="text-[10px] font-bold flex items-center gap-1 uppercase tracking-wider text-slate-500">
                                    {o.type === 'Produto' ? <Box size={10}/> : <Wrench size={10}/>} {o.type}
                                </span>
                              </div>
                            </td>
                            <td className="px-6 py-4">
                              <p className={`font-black text-base leading-none ${layoutMode === 'gaming' ? 'text-white' : 'text-slate-800'}`}>#{o.orderNumber}</p>
                              <p className={`text-[11px] font-bold uppercase mt-1 ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-blue-600'}`}>{o.branch}</p>
                              <p className="text-[9px] text-slate-500 font-medium">{new Intl.DateTimeFormat('pt-BR').format(o.createdAt)}</p>
                            </td>
                            <td className="px-6 py-4">
                                <p className={`text-[11px] font-black uppercase tracking-tight truncate max-w-[150px] ${layoutMode === 'gaming' ? 'text-blue-400' : 'text-slate-700'}`}>{o.supplier || 'SISTEMA'}</p>
                            </td>
                            <td className="px-6 py-4 text-right">
                              <span className={`font-black text-lg ${layoutMode === 'gaming' ? 'text-white' : 'text-slate-900'}`}>{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(o.value)}</span>
                            </td>
                            <td className="px-6 py-4">
                              <div className="flex items-center justify-center gap-3">
                                <button onClick={() => onToggleComplete(o.id, o.completed)} className={`p-2 rounded border transition-all ${
                                    o.completed 
                                    ? (layoutMode === 'gaming' ? 'bg-emerald-500 text-slate-950 border-emerald-400 shadow-[0_0_10px_#10b981]' : 'bg-emerald-100 text-emerald-600 border-emerald-200') 
                                    : (layoutMode === 'gaming' ? 'bg-slate-900 text-slate-600 border-slate-700 hover:border-cyan-500' : 'bg-white text-slate-400 border-slate-200 hover:bg-slate-50')
                                }`}>{o.completed ? <CheckSquare size={20}/> : <Square size={20}/>}</button>
                                <button onClick={() => onEdit(o)} className={`p-2 border rounded transition-all ${
                                    layoutMode === 'gaming' ? 'bg-slate-900 border-slate-700 text-blue-400 hover:border-blue-400' : 'bg-white border-slate-200 text-blue-600 hover:bg-blue-50'
                                }`}><Edit2 size={16}/></button>
                                <button onClick={() => window.confirm("ABORTAR E DELETAR REGISTRO?") && onDelete(o.id)} className={`p-2 border rounded transition-all ${
                                    layoutMode === 'gaming' ? 'bg-slate-900 border-slate-700 text-red-500 hover:border-red-500' : 'bg-white border-slate-200 text-red-500 hover:bg-red-50'
                                }`}><Trash2 size={16}/></button>
                              </div>
                            </td>
                          </tr>
                        ))
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          );
        }

        // --- Componente: Formulário ---
        function OrderForm({ initialData, onSave, onCancel, currentUserProfile, layoutMode }) {
          const [formData, setFormData] = useState({
            maintainer: '', branch: '', orderNumber: '', supplier: '', 
            value: '', status: 'ag. aprovação', type: 'Produto', notes: '', userProfile: currentUserProfile
          });

          useEffect(() => { if(initialData) setFormData({...initialData}); }, [initialData]);

          const cardClass = layoutMode === 'gaming' ? 'game-card border-cyan-500/30' : 'bg-white rounded-2xl shadow-2xl border border-slate-100';
          const inputClass = layoutMode === 'gaming' 
            ? 'bg-slate-950 border-slate-700 text-white focus:border-cyan-400' 
            : 'bg-slate-50 border-slate-200 text-slate-900 focus:bg-white focus:border-blue-400';

          return (
            <div className={`${cardClass} max-w-2xl mx-auto overflow-hidden animate-in zoom-in duration-300`}>
              <div className={`p-5 border-b flex justify-between items-center ${layoutMode === 'gaming' ? 'bg-slate-900 border-cyan-500/20' : 'bg-slate-50 border-slate-100'}`}>
                <div>
                    <h2 className={`text-2xl font-black uppercase tracking-tighter ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>{initialData ? 'Editar Missão' : 'Novo Lançamento'}</h2>
                    <p className={`text-[10px] font-black uppercase tracking-[0.3em] ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>Operador Ativo: {currentUserProfile}</p>
                </div>
                <button onClick={onCancel} className="p-2 rounded-full text-slate-400 hover:text-red-500 transition-colors"><X/></button>
              </div>
              <form onSubmit={e => { e.preventDefault(); onSave(formData); }} className="p-8 space-y-6">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                  <div className="space-y-2">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>01. Mantenedora</label>
                    <input list="m-list" className={`w-full p-3 border rounded font-bold outline-none transition-all uppercase ${inputClass}`} value={formData.maintainer} onChange={e => setFormData({...formData, maintainer: e.target.value})} placeholder="Selecione..." /><datalist id="m-list">{LISTA_MANTENEDORAS.map(m => <option key={m} value={m}/>)}</datalist>
                  </div>
                  <div className="space-y-2">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>02. Filial / Base</label>
                    <input list="f-list" className={`w-full p-3 border rounded font-bold outline-none transition-all uppercase ${inputClass}`} value={formData.branch} onChange={e => setFormData({...formData, branch: e.target.value})} placeholder="Localização..." /><datalist id="f-list">{LISTA_FILIAIS.map(f => <option key={f} value={f}/>)}</datalist>
                  </div>
                  <div className="space-y-2">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>03. Identificador ID</label>
                    <input className={`w-full p-3 border rounded font-bold outline-none transition-all ${inputClass}`} value={formData.orderNumber} onChange={e => setFormData({...formData, orderNumber: e.target.value})} required placeholder="Número do pedido..." />
                  </div>
                  <div className="space-y-2">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>04. Fornecedor</label>
                    <input className={`w-full p-3 border rounded font-bold outline-none transition-all uppercase ${inputClass}`} value={formData.supplier} onChange={e => setFormData({...formData, supplier: e.target.value})} placeholder="Nome da empresa..." />
                  </div>
                  <div className="space-y-2">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>05. Créditos (R$)</label>
                    <input type="number" step="0.01" className={`w-full p-3 border rounded font-black text-xl outline-none transition-all ${
                        layoutMode === 'gaming' ? 'bg-slate-950 border-slate-700 text-emerald-400 focus:border-emerald-400' : 'bg-slate-50 border-slate-200 text-emerald-600'
                    }`} value={formData.value} onChange={e => setFormData({...formData, value: e.target.value})} required placeholder="0,00" />
                  </div>
                  <div className="space-y-2">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>06. Categoria</label>
                    <div className={`flex gap-2 p-1 rounded border ${layoutMode === 'gaming' ? 'bg-slate-950 border-slate-800' : 'bg-slate-100 border-slate-200'}`}>
                        <button type="button" onClick={() => setFormData({...formData, type: 'Produto'})} className={`flex-1 py-2 rounded text-xs font-black uppercase transition-all ${
                            formData.type === 'Produto' 
                            ? (layoutMode === 'gaming' ? 'bg-cyan-500 text-slate-950 shadow-lg' : 'bg-white text-blue-600 shadow-sm border border-slate-100') 
                            : 'text-slate-500'
                        }`}>Produto</button>
                        <button type="button" onClick={() => setFormData({...formData, type: 'Serviço'})} className={`flex-1 py-2 rounded text-xs font-black uppercase transition-all ${
                            formData.type === 'Serviço' 
                            ? (layoutMode === 'gaming' ? 'bg-orange-500 text-slate-950 shadow-lg' : 'bg-white text-orange-600 shadow-sm border border-slate-100') 
                            : 'text-slate-500'
                        }`}>Serviço</button>
                    </div>
                  </div>
                </div>
                <div className="space-y-3">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>07. Status Operacional</label>
                    <div className="grid grid-cols-2 sm:grid-cols-5 gap-2">
                        {['aprovado', 'enviado', 'ag. aprovação', 'aguardando justificativa', 'reprovado Enio'].map(s => (
                            <button key={s} type="button" onClick={() => setFormData({...formData, status: s})} className={`py-2 rounded border text-[9px] font-black uppercase transition-all ${
                                formData.status === s 
                                ? (layoutMode === 'gaming' ? 'bg-white text-slate-900 border-white shadow-[0_0_10px_white]' : 'bg-slate-800 text-white border-slate-900') 
                                : (layoutMode === 'gaming' ? 'bg-slate-900 text-slate-500 border-slate-800' : 'bg-white text-slate-400 border-slate-200')
                            }`}>{s}</button>
                        ))}
                    </div>
                </div>
                <div className="space-y-2">
                    <label className={`text-xs font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>08. Log de Observações</label>
                    <textarea className={`w-full p-3 border rounded font-medium outline-none resize-none ${inputClass}`} rows="2" value={formData.notes} onChange={e => setFormData({...formData, notes: e.target.value})} placeholder="Inserir dados extras..." />
                </div>
                <div className={`flex gap-4 pt-6 border-t ${layoutMode === 'gaming' ? 'border-slate-800' : 'border-slate-100'}`}>
                    <button type="button" onClick={onCancel} className="flex-1 py-4 text-slate-500 font-black uppercase tracking-widest hover:text-red-500 transition-colors">Cancelar</button>
                    <button type="submit" className={`flex-[2] py-4 rounded-lg font-black uppercase tracking-widest shadow-xl flex items-center justify-center gap-2 ${
                        layoutMode === 'gaming' ? 'bg-cyan-600 text-white btn-game' : 'bg-blue-600 text-white hover:bg-blue-700'
                    }`}><Save size={20}/> Gravar Registro</button>
                </div>
              </form>
            </div>
          );
        }

        // --- Componente: Modal de Relatório ---
        function ReportModal({ orders, onClose, layoutMode }) {
          const total = orders.reduce((acc, curr) => acc + (curr.status === 'reprovado Enio' ? 0 : parseFloat(curr.value || 0)), 0);
          return (
            <div className={`fixed inset-0 z-[100] overflow-y-auto animate-in fade-in slide-in-from-bottom-10 duration-500 ${layoutMode === 'gaming' ? 'bg-slate-950' : 'bg-slate-50'}`}>
              <div className="p-8 max-w-5xl mx-auto">
                <div className={`flex justify-between items-end mb-12 print:hidden border-b pb-8 ${layoutMode === 'gaming' ? 'border-cyan-500/30' : 'border-slate-200'}`}>
                  <div>
                    <h2 className={`text-5xl font-black tracking-tighter uppercase ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>Relatório Geral</h2>
                    <p className={`font-bold tracking-[0.4em] uppercase text-xs mt-2 ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>Manutenções Consolidadas // {new Intl.DateTimeFormat('pt-BR').format(new Date())}</p>
                  </div>
                  <div className="flex gap-4">
                    <button onClick={() => window.print()} className={`px-8 py-3 rounded font-black uppercase tracking-widest flex items-center gap-2 shadow-lg transition-all ${
                        layoutMode === 'gaming' ? 'bg-white text-slate-950 btn-game' : 'bg-slate-800 text-white hover:bg-black'
                    }`}><Printer size={20}/> Gerar PDF</button>
                    <button onClick={onClose} className="text-slate-500 px-8 py-3 font-bold uppercase hover:text-slate-800 transition-colors">Fechar HUD</button>
                  </div>
                </div>
                <div className={`${layoutMode === 'gaming' ? 'game-card p-1 border-slate-700' : 'bg-white rounded-2xl shadow-2xl border p-4'} shadow-2xl`}>
                    <table className="w-full text-xs text-left border-collapse">
                      <thead>
                        <tr className={`font-black uppercase tracking-widest border-b-2 ${
                            layoutMode === 'gaming' ? 'bg-slate-800 text-cyan-400 border-cyan-500' : 'bg-slate-50 text-slate-600 border-slate-200'
                        }`}>
                            <th className="py-4 px-3">Data</th>
                            <th className="py-4 px-3">Identidade</th>
                            <th className="py-4 px-3">Base / Filial</th>
                            <th className="py-4 px-3">Status</th>
                            <th className="py-4 px-3 text-right">Créditos (R$)</th>
                        </tr>
                      </thead>
                      <tbody className={layoutMode === 'gaming' ? 'text-slate-300' : 'text-slate-700'}>
                        {orders.map(o => (
                            <tr key={o.id} className={`border-b ${layoutMode === 'gaming' ? 'border-slate-800 hover:bg-slate-800/30' : 'border-slate-100 hover:bg-slate-50'}`}>
                                <td className="py-3 px-3">{new Intl.DateTimeFormat('pt-BR').format(o.createdAt)}</td>
                                <td className={`py-3 px-3 font-black ${layoutMode === 'gaming' ? 'text-white' : 'text-slate-900'}`}>#{o.orderNumber}</td>
                                <td className={`py-3 px-3 uppercase ${layoutMode === 'gaming' ? 'text-cyan-400/70' : 'text-slate-600'}`}>{o.branch}</td>
                                <td className="py-3 px-3 italic uppercase text-[10px]">{o.status}</td>
                                <td className={`py-3 px-3 text-right font-black ${layoutMode === 'gaming' ? 'text-white' : 'text-slate-900'}`}>{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(o.value)}</td>
                            </tr>
                        ))}
                      </tbody>
                      <tfoot>
                        <tr className={`font-black text-lg ${layoutMode === 'gaming' ? 'bg-slate-950' : 'bg-slate-50'}`}>
                            <td colSpan="4" className={`py-6 text-right px-6 uppercase tracking-widest ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>Total Final:</td>
                            <td className={`py-6 text-right px-3 font-black ${layoutMode === 'gaming' ? 'text-emerald-400 neon-text-blue' : 'text-emerald-600'}`}>{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(total)}</td>
                        </tr>
                      </tfoot>
                    </table>
                </div>
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
