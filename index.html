<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA DE MANUTENÇÃO - COMANDO CENTRAL</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
        }
    }
    </script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');

        /* Estilos Globais Dinâmicos */
        .layout-gaming {
            font-family: 'Rajdhani', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }

        .layout-traditional {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: #0f172a;
        }

        /* Estilos Gaming */
        .neon-border {
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.3), inset 0 0 5px rgba(34, 211, 238, 0.2);
            border: 1px solid rgba(34, 211, 238, 0.5);
        }

        .neon-text-blue {
            text-shadow: 0 0 8px rgba(34, 211, 238, 0.8);
        }

        .game-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 1);
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%);
        }

        .btn-game {
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0% 30%);
            transition: all 0.2s ease;
        }

        .btn-game:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
        }

        .completed-row-gaming {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.02) 100%) !important;
            border-left: 4px solid #10b981 !important;
        }

        /* Estilos Tradicionais */
        .trad-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .completed-row-traditional {
            background-color: #f0fdf4 !important;
            border-left: 4px solid #22c55e !important;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #64748b; border-radius: 10px; }

        @media print {
            body { background: white !important; color: black !important; }
            .print-hidden { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script>
        window.__firebase_config = JSON.stringify({
            apiKey: "AIzaSyC2sCd7LLsDIgtsyKWrz2aaHmBojglK7pg",
            authDomain: "controle-de-manutencoes-49274.firebaseapp.com",
            projectId: "controle-de-manutencoes-49274",
            storageBucket: "controle-de-manutencoes-49274.firebasestorage.app",
            messagingSenderId: "32715522228",
            appId: "1:32715522228:web:65637da97de422c2f497e1",
            measurementId: "G-T6TS6Y6NT5"
        });
        window.__app_id = "controle-pedidos-game-v1";
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Plus, Search, Edit2, Trash2, Save, X, FileText, Building2, 
          DollarSign, LayoutDashboard, Filter, CheckCircle2, Clock, 
          XCircle, Package, Tag, User, Truck, Briefcase, Wrench, 
          Box, Send, MessageSquare, CheckSquare, Square, Printer, 
          Download, Lock, LogOut, AlertTriangle, ShieldCheck, Zap, 
          Target, BarChart3, Terminal, Monitor, Laptop
        } from 'lucide-react';

        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'firebase/auth';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, serverTimestamp, query } from 'firebase/firestore';

        const firebaseConfig = JSON.parse(window.__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = window.__app_id;

        const LISTA_MANTENEDORAS = ["AESMS", "ACESC", "AEI", "AESA", "AESGF", "AESJC", "AESPI", "APESU", "ASCEC", "ASPER", "ASSOBES", "AVIES", "BRICOR", "CESC", "CIESPT", "DI GENIO", "SINEC", "SUPERO", "SUPERO EC", "ASSUPERO", "ECEL"].sort();
        const LISTA_FILIAIS = ["Alphaville", "Anchieta", "Araçatuba", "Araraquara", "Assis", "Bacelar", "Bauru", "Brasilia", "Campinas", "Cancioneiro", "Cid. Universitária", "Goiania Flamboyant", "Jundiai", "Limeira", "Manaus", "Marques S. Vicente", "Norte", "Paraiso", "Paulista", "Paz", "Paz / Henri Dunant", "Pinheiros", "Ribeirão Preto", "Santos", "São José do Rio Pardo", "São José dos Campos", "Sorocaba", "Taquari", "Tatuape", "Vergueiro", "São Jose do Rio Preto"].sort();

        function App() {
          const [user, setUser] = useState(null);
          const [orders, setOrders] = useState([]);
          const [loading, setLoading] = useState(true);
          const [view, setView] = useState('list');
          const [editingOrder, setEditingOrder] = useState(null);
          const [currentUserProfile, setCurrentUserProfile] = useState(null); 
          const [showReport, setShowReport] = useState(false); 
          const [passwordModalOpen, setPasswordModalOpen] = useState(false);
          const [pendingProfile, setPendingProfile] = useState(null);
          const [passwordInput, setPasswordInput] = useState('');
          const [layoutMode, setLayoutMode] = useState('gaming');

          useEffect(() => {
            const initAuth = async () => {
              try {
                if (typeof window.__initial_auth_token !== 'undefined' && window.__initial_auth_token) {
                    try {
                        await signInWithCustomToken(auth, window.__initial_auth_token);
                    } catch (tokenError) {
                        await signInAnonymously(auth);
                    }
                } else {
                    await signInAnonymously(auth);
                }
              } catch (error) {
                setLoading(false);
              }
            };
            initAuth();

            const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
              setUser(currentUser);
              if(currentUser) setLoading(false);
            });
            return () => unsubscribe();
          }, []);

          useEffect(() => {
            if (!user || !db) return;
            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'orders'));
            const unsubscribe = onSnapshot(q, (snapshot) => {
                const loadedOrders = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data(),
                  createdAt: doc.data().createdAt?.toDate() || new Date()
                }));
                loadedOrders.sort((a, b) => b.createdAt - a.createdAt);
                setOrders(loadedOrders);
                setLoading(false);
              }, (error) => { 
                  setLoading(false);
              }
            );
            return () => unsubscribe();
          }, [user]);

          const handlePasswordSubmit = (e) => {
            e.preventDefault();
            let valid = (pendingProfile === 'NELSON' && passwordInput === 'BIA123') || (pendingProfile === 'JORDAN' && passwordInput === '1234');
            if (valid) {
                setCurrentUserProfile(pendingProfile);
                setPasswordModalOpen(false);
                setPasswordInput('');
            } else {
                alert("ACESSO NEGADO: Senha Inválida");
                setPasswordInput('');
            }
          };

          const handleSave = async (orderData) => {
            if (!user) return;
            try {
              const collectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
              const dataToSave = { 
                ...orderData, 
                userProfile: orderData.id ? (orderData.userProfile || 'JORDAN') : currentUserProfile,
                updatedAt: serverTimestamp()
              };

              if (editingOrder) {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'orders', editingOrder.id);
                await updateDoc(docRef, dataToSave);
              } else {
                await addDoc(collectionRef, { 
                    ...dataToSave, 
                    createdAt: serverTimestamp(), 
                    completed: false 
                });
              }
              setView('list');
              setEditingOrder(null);
            } catch (error) { 
              alert("FALHA NA GRAVAÇÃO: " + error.message);
            }
          };

          const handleDelete = async (id) => {
            if (!window.confirm("CONFIRMAR EXCLUSÃO PERMANENTE?")) return;
            try {
              await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id));
            } catch (error) {
              alert("Erro ao excluir: " + error.message);
            }
          };

          const handleToggleComplete = async (id, currentVal) => {
            try {
              await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), { 
                completed: !currentVal,
                updatedAt: serverTimestamp()
              });
            } catch (error) {
              alert("Erro ao atualizar status: " + error.message);
            }
          };

          const handleUpdateNote = async (id, noteText) => {
            try {
              await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), { 
                notes: noteText,
                updatedAt: serverTimestamp()
              });
            } catch (error) {
              alert("Erro ao salvar nota: " + error.message);
            }
          };

          if (loading) return (
            <div className="min-h-screen flex flex-col items-center justify-center bg-slate-950">
                <div className="w-64 h-2 bg-slate-800 rounded-full overflow-hidden mb-4 neon-border">
                    <div className="h-full bg-cyan-400 animate-[pulse_1s_infinite] shadow-[0_0_10px_#22d3ee]"></div>
                </div>
                <p className="text-cyan-400 font-bold tracking-widest animate-pulse uppercase text-sm">Estabelecendo Conexão Seguro...</p>
            </div>
          );

          return (
            <div className={`min-h-screen pb-10 transition-colors duration-500 ${layoutMode === 'gaming' ? 'layout-gaming' : 'layout-traditional'}`}>
              {/* MODAL DE LOGIN */}
              {passwordModalOpen && (
                <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-md p-4">
                  <div className={`${layoutMode === 'gaming' ? 'game-card p-1' : 'bg-white rounded-xl shadow-2xl overflow-hidden'} w-full max-w-sm`}>
                    <div className={`${layoutMode === 'gaming' ? 'bg-slate-900 border-b border-cyan-500/30 text-cyan-400' : 'bg-slate-100 border-b text-slate-800'} p-4 flex items-center justify-center gap-2`}>
                      <ShieldCheck size={24} />
                      <h3 className="font-bold text-xl uppercase tracking-tighter text-center">Operador: {pendingProfile}</h3>
                    </div>
                    <form onSubmit={handlePasswordSubmit} className="p-6">
                      <input 
                        type="password" autoFocus placeholder="••••"
                        className={`w-full px-4 py-3 rounded-lg mb-6 text-center text-xl tracking-[0.5em] outline-none ${
                            layoutMode === 'gaming' 
                            ? 'bg-slate-950 border border-slate-700 text-white focus:ring-2 focus:ring-cyan-500' 
                            : 'bg-white border border-slate-300 text-slate-900 focus:ring-2 focus:ring-blue-500'
                        }`}
                        value={passwordInput} onChange={e => setPasswordInput(e.target.value)}
                      />
                      <div className="flex gap-3">
                        <button type="button" onClick={() => setPasswordModalOpen(false)} className="flex-1 py-3 text-slate-500 font-bold uppercase hover:text-slate-400 transition-colors">Cancelar</button>
                        <button type="submit" className={`flex-1 py-3 font-black uppercase rounded-lg shadow-lg ${
                            layoutMode === 'gaming' ? 'bg-cyan-600 text-white btn-game' : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}>Aceder</button>
                      </div>
                    </form>
                  </div>
                </div>
              )}

              {/* HUD DO CABEÇALHO */}
              <header className={`sticky top-0 z-10 px-4 py-2 backdrop-blur-md print:hidden border-b transition-all ${
                layoutMode === 'gaming' 
                ? 'bg-slate-900/80 border-cyan-500/20' 
                : 'bg-white/90 border-slate-200'
              }`}>
                <div className="max-w-6xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
                  <div className="flex items-center gap-3">
                    <div className={`p-2 rounded-lg border ${
                        layoutMode === 'gaming' ? 'bg-cyan-500/10 border-cyan-500/50 text-cyan-400' : 'bg-blue-50 border-blue-200 text-blue-600'
                    }`}>
                        <Terminal size={24} />
                    </div>
                    <div>
                        <h1 className={`text-xl font-black tracking-tighter uppercase leading-none ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>
                            Centro de Comando
                        </h1>
                        <p className={`text-[10px] font-bold tracking-[0.2em] uppercase ${layoutMode === 'gaming' ? 'text-cyan-400/70' : 'text-slate-400'}`}>
                            SISTEMA v2.6 // DATABASE: SINCRONIZADA
                        </p>
                    </div>
                  </div>

                  <div className="flex items-center gap-4">
                    <button 
                        onClick={() => setLayoutMode(prev => prev === 'gaming' ? 'traditional' : 'gaming')}
                        className={`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-bold transition-all uppercase ${
                            layoutMode === 'gaming' 
                            ? 'bg-slate-800 border-slate-700 text-cyan-400 hover:bg-slate-700' 
                            : 'bg-slate-100 border-slate-200 text-slate-600 hover:bg-slate-200'
                        }`}
                    >
                        {layoutMode === 'gaming' ? <><Laptop size={14}/> Tradicional</> : <><Monitor size={14}/> Gamming</>}
                    </button>

                    <div className={`flex p-1 rounded-lg border transition-colors ${layoutMode === 'gaming' ? 'bg-slate-800 border-slate-700' : 'bg-slate-100 border-slate-200'}`}>
                      {['JORDAN', 'NELSON'].map(p => (
                        <button 
                            key={p} 
                            onClick={() => { setPendingProfile(p); setPasswordInput(''); setPasswordModalOpen(true); }} 
                            className={`px-4 py-1.5 rounded-md text-xs font-black transition-all ${
                                currentUserProfile === p 
                                ? (layoutMode === 'gaming' ? 'bg-cyan-500 text-slate-950 shadow-[0_0_10px_#22d3ee]' : 'bg-white text-blue-600 shadow-sm border border-slate-100') 
                                : 'text-slate-500 hover:text-slate-400'
                            }`}
                        >
                            {p}
                        </button>
                      ))}
                    </div>
                    {currentUserProfile && (
                      <div className={`flex items-center gap-2 border-l pl-4 ${layoutMode === 'gaming' ? 'border-slate-700' : 'border-slate-200'}`}>
                        <button onClick={() => setShowReport(true)} className={`p-2 rounded-lg border transition-colors ${
                            layoutMode === 'gaming' ? 'bg-slate-800 border-slate-700 text-cyan-400 hover:bg-slate-700' : 'bg-white border-slate-200'
                        }`}><BarChart3 size={20} /></button>
                        <button onClick={() => { setEditingOrder(null); setView('form'); }} className={`px-4 py-2 rounded-lg font-black uppercase text-xs flex items-center gap-2 shadow-lg ${
                            layoutMode === 'gaming' ? 'bg-emerald-500 text-slate-950 btn-game' : 'bg-blue-600 text-white'
                        }`}><Plus size={18}/> Novo</button>
                        <button onClick={() => setCurrentUserProfile(null)} className="p-2 text-slate-400 hover:text-red-500"><LogOut size={20} /></button>
                      </div>
                    )}
                  </div>
                </div>
              </header>

              <main className="max-w-6xl mx-auto p-4 pt-8">
                {!currentUserProfile ? (
                  <div className="text-center py-32 animate-in fade-in zoom-in duration-500">
                    <div className="relative inline-block mb-8">
                        <div className={`absolute inset-0 blur-3xl opacity-10 animate-pulse ${layoutMode === 'gaming' ? 'bg-cyan-500' : 'bg-blue-500'}`}></div>
                        <div className={`${layoutMode === 'gaming' ? 'game-card p-8 neon-border' : 'bg-white rounded-2xl p-10 shadow-xl border border-slate-100'} relative`}>
                            <Lock size={64} className={`${layoutMode === 'gaming' ? 'text-cyan-400 animate-bounce' : 'text-slate-300'} mx-auto mb-4`} />
                            <h2 className={`text-3xl font-black tracking-tighter uppercase ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>Acesso Restrito</h2>
                            <p className={`${layoutMode === 'gaming' ? 'text-cyan-400/60' : 'text-slate-500'} font-bold uppercase text-xs tracking-widest mt-2`}>Autenticação de operador necessária</p>
                        </div>
                    </div>
                  </div>
                ) : (
                  view === 'list' ? (
                    <DashboardAndList 
                      orders={orders} currentUserProfile={currentUserProfile} layoutMode={layoutMode}
                      onEdit={o => {setEditingOrder(o); setView('form');}}
                      onDelete={handleDelete}
                      onToggleComplete={handleToggleComplete}
                      onUpdateNote={handleUpdateNote}
                      showReport={showReport} onCloseReport={() => setShowReport(false)}
                    />
                  ) : (
                    <OrderForm initialData={editingOrder} currentUserProfile={currentUserProfile} layoutMode={layoutMode} onSave={handleSave} onCancel={() => setView('list')} />
                  )
                )}
              </main>
            </div>
          );
        }

        // --- Dashboard e Lista ---
        function DashboardAndList({ orders, onEdit, onDelete, onUpdateNote, onToggleComplete, currentUserProfile, showReport, onCloseReport, layoutMode }) {
          const [searchTerm, setSearchTerm] = useState('');
          const [filterBranch, setFilterBranch] = useState('');
          const [filterMaintainer, setFilterMaintainer] = useState('');
          const [filterStatus, setFilterStatus] = useState('');
          const [filterSupplier, setFilterSupplier] = useState('');
          const [noteModal, setNoteModal] = useState({ open: false, order: null, text: '' });

          // --- AJUSTE: Normalização de fornecedores para o filtro ---
          const listaFornecedores = useMemo(() => {
            const rawSuppliers = orders
              .filter(o => (o.userProfile || 'JORDAN') === currentUserProfile)
              .map(o => (o.supplier || '').trim())
              .filter(val => val !== '');
            
            // Usamos um Map para manter a versão original do nome mas evitar duplicatas case-insensitive
            const uniqueMap = new Map();
            rawSuppliers.forEach(s => {
                const key = s.toUpperCase();
                if (!uniqueMap.has(key)) {
                    uniqueMap.set(key, s);
                }
            });
            
            return Array.from(uniqueMap.values()).sort((a, b) => a.localeCompare(b));
          }, [orders, currentUserProfile]);

          const filteredOrders = useMemo(() => {
            return orders.filter(o => {
              const isCurrentUser = (o.userProfile || 'JORDAN') === currentUserProfile;
              if (!isCurrentUser) return false;

              const term = searchTerm.toLowerCase();
              const oSupplier = (o.supplier || '').trim();
              const fSupplier = (filterSupplier || '').trim();

              const matchesSearch = 
                (o.orderNumber?.toLowerCase().includes(term) || 
                 o.branch?.toLowerCase().includes(term) || 
                 oSupplier.toLowerCase().includes(term));
              
              const matchesBranch = !filterBranch || o.branch === filterBranch;
              const matchesMaintainer = !filterMaintainer || o.maintainer === filterMaintainer;
              const matchesStatus = !filterStatus || o.status === filterStatus;
              
              // --- AJUSTE: Comparação Normalizada de Fornecedor ---
              const matchesSupplier = !fSupplier || oSupplier.toUpperCase() === fSupplier.toUpperCase();
              
              return matchesSearch && matchesBranch && matchesMaintainer && matchesStatus && matchesSupplier;
            });
          }, [orders, searchTerm, filterBranch, filterMaintainer, filterStatus, filterSupplier, currentUserProfile]);

          const stats = useMemo(() => {
            const valid = filteredOrders.filter(o => o.status !== 'reprovado Enio');
            const total = valid.reduce((acc, curr) => acc + parseFloat(curr.value || 0), 0);
            return { count: filteredOrders.length, total };
          }, [filteredOrders]);

          const cardClass = layoutMode === 'gaming' ? 'game-card' : 'trad-card';

          return (
            <div className="space-y-6 animate-in slide-in-from-right-10 duration-500">
              {showReport && <ReportModal orders={filteredOrders} onClose={onCloseReport} layoutMode={layoutMode} />}
              {noteModal.open && (
                <div className="fixed inset-0 z-[80] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm">
                  <div className={`${layoutMode === 'gaming' ? 'game-card' : 'bg-white rounded-xl shadow-2xl border'} w-full max-w-md p-6`}>
                    <h3 className={`font-bold text-lg mb-4 flex items-center gap-2 ${layoutMode === 'gaming' ? 'text-white' : 'text-slate-800'}`}>
                        <MessageSquare size={20} className="text-blue-500"/> Observações
                    </h3>
                    <textarea className={`w-full h-32 p-3 border rounded-lg outline-none resize-none ${
                        layoutMode === 'gaming' ? 'bg-slate-950 border-slate-700 text-white focus:ring-2 focus:ring-cyan-500' : 'bg-slate-50 border-slate-200'
                    }`} value={noteModal.text} onChange={e => setNoteModal({...noteModal, text: e.target.value})} placeholder="Detalhes..." />
                    <div className="flex justify-end gap-2 mt-4">
                      <button onClick={() => setNoteModal({open: false, order: null, text: ''})} className="px-4 py-2 text-slate-500 font-medium">Cancelar</button>
                      <button onClick={() => { onUpdateNote(noteModal.order.id, noteModal.text); setNoteModal({open: false, order: null, text: ''}); }} className={`px-6 py-2 rounded-lg font-bold text-white ${layoutMode === 'gaming' ? 'bg-cyan-600' : 'bg-blue-600'}`}>Salvar</button>
                    </div>
                  </div>
                </div>
              )}

              <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div className={`${cardClass} p-4 relative overflow-hidden`}>
                  <p className={`text-[10px] font-black uppercase tracking-[0.2em] ${layoutMode === 'gaming' ? 'text-cyan-400' : 'text-slate-500'}`}>Missões ({currentUserProfile})</p>
                  <p className={`text-4xl font-black ${layoutMode === 'gaming' ? 'text-white neon-text-blue' : 'text-slate-800'}`}>{stats.count}</p>
                </div>
                <div className={`${cardClass} p-4 col-span-1 sm:col-span-2 relative overflow-hidden`}>
                  <p className={`text-[10px] font-black uppercase tracking-[0.2em] ${layoutMode === 'gaming' ? 'text-emerald-400' : 'text-slate-500'}`}>Volume de Créditos</p>
                  <p className={`text-4xl font-black ${layoutMode === 'gaming' ? 'text-emerald-400 shadow-emerald-500/20' : 'text-emerald-600'}`}>
                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(stats.total)}
                  </p>
                </div>
              </div>

              <div className={`${cardClass} p-4 space-y-4`}>
                <div className="relative">
                    <Search className={`absolute left-3 top-1/2 -translate-y-1/2 ${layoutMode === 'gaming' ? 'text-cyan-400/50' : 'text-slate-400'}`} size={20} />
                    <input 
                        type="text" placeholder="BUSCA AVANÇADA POR NÚMERO OU FILIAL..." 
                        className={`w-full pl-10 pr-4 py-3 rounded-lg text-sm outline-none transition-all uppercase font-bold tracking-wider ${
                            layoutMode === 'gaming' 
                            ? 'bg-slate-950/50 border border-cyan-500/20 text-white' 
                            : 'bg-white border border-slate-200 text-slate-800'
                        }`} 
                        value={searchTerm} onChange={e => setSearchTerm(e.target.value)} 
                    />
                </div>
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterBranch} onChange={e => setFilterBranch(e.target.value)}><option value="">FILIAL: TODAS</option>{LISTA_FILIAIS.map(f => <option key={f} value={f}>{f.toUpperCase()}</option>)}</select>
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterMaintainer} onChange={e => setFilterMaintainer(e.target.value)}><option value="">MANTENEDORA</option>{LISTA_MANTENEDORAS.map(m => <option key={m} value={m}>{m}</option>)}</select>
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterSupplier} onChange={e => setFilterSupplier(e.target.value)}><option value="">FORNECEDOR</option>{listaFornecedores.map(s => <option key={s} value={s}>{s.toUpperCase()}</option>)}</select>
                  <select className={`p-2 rounded text-xs font-bold uppercase outline-none ${
                    layoutMode === 'gaming' ? 'bg-slate-950 border border-slate-700 text-cyan-400' : 'bg-white border border-slate-200 text-slate-600'
                  }`} value={filterStatus} onChange={e => setFilterStatus(e.target.value)}><option value="">STATUS: GERAL</option><option value="aprovado">APROVADO</option><option value="enviado">ENVIADO</option><option value="ag. aprovação">AG. APROVAÇÃO</option><option value="aguardando justificativa">AG. JUSTIFICATIVA</option><option value="reprovado Enio">REPROVADO</option></select>
                </div>
              </div>

              <div className={`${cardClass} overflow-hidden shadow-xl`}>
                <div className="overflow-x-auto">
                  <table className="w-full text-left text-sm min-w-[700px]">
                    <thead className={`font-black uppercase text-[10px] tracking-widest border-b ${
                        layoutMode === 'gaming' ? 'bg-slate-900/80 text-cyan-400 border-slate-800' : 'bg-white text-slate-500 border-slate-100'
                    }`}>
                      <tr>
                        <th className="px-6 py-4">Status / Tipo</th>
                        <th className="px-6 py-4">ID / Filial</th>
                        <th className="px-6 py-4">Fornecedor</th>
                        <th className="px-6 py-4 text-right">Créditos (R$)</th>
                        <th className="px-6 py-4 text-center">Operacional</th>
                      </tr>
                    </thead>
                    <tbody className={`divide-y ${layoutMode === 'gaming' ? 'divide-slate-800/50' : 'divide-slate-100'}`}>
                      {filteredOrders.length === 0 ? (
                        <tr><td colSpan="5" className="px-6 py-10 text-center font-bold text-slate-500 uppercase tracking-widest italic opacity-50">Nenhuma missão activa detectada nos sensores</td></tr>
                      ) : (
                        filteredOrders.map(o => (
                          <tr key={o.id} className={`transition-all duration-300 ${
                            o.completed 
                            ? (layoutMode === 'gaming' ? 'completed-row-gaming' : 'completed-row-traditional') 
                            : (layoutMode === 'gaming' ? 'hover:bg-slate-800/30' : 'hover:bg-slate-50')
                          }`}>
                            <td className="px-6 py-4">
                              <div className="flex flex-col gap-1 items-start">
                                <span className={`text-[10px] font-black px-2 py-0.5 rounded border uppercase transition-all ${
                                    o.status === 'aprovado' ? 'text-emerald-500 border-emerald-500/50 shadow-[0_0_8px_rgba(16,185,129,0.3)]' : o.status === 'reprovado Enio' ? 'text-red-500 border-red-500/50' : 'text-amber-500 border-amber-500/50'
                                }`}>{o.status}</span>
                                <span className="text-[10px] opacity-40 uppercase font-bold tracking-tighter">{o.type}</span>
                              </div>
                            </td>
                            <td className="px-6 py-4">
                              <p className={`font-black text-base leading-none ${layoutMode === 'gaming' ? 'text-white' : 'text-slate-800'}`}>#{o.orderNumber}</p>
                              <p className="text-[11px] font-bold uppercase mt-1 text-blue-500">{o.branch}</p>
                            </td>
                            <td className="px-6 py-4">
                                <p className={`text-[11px] font-black uppercase truncate max-w-[180px] ${layoutMode === 'gaming' ? 'text-blue-300' : 'text-slate-700'}`}>{o.supplier || 'N/A'}</p>
                            </td>
                            <td className="px-6 py-4 text-right font-black">
                              {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(o.value)}
                            </td>
                            <td className="px-6 py-4">
                              <div className="flex items-center justify-center gap-2">
                                <button onClick={() => onToggleComplete(o.id, o.completed)} className={`p-2 rounded border transition-all ${
                                    o.completed ? 'bg-emerald-500 text-white border-emerald-400' : 'text-slate-400 hover:border-cyan-500'
                                }`} title="Missão Concluída"><CheckSquare size={18}/></button>
                                <button onClick={() => setNoteModal({open: true, order: o, text: o.notes || ''})} className={`p-2 border rounded hover:border-blue-500 transition-colors ${o.notes ? 'text-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.3)]' : 'text-slate-400'}`} title="Log de Dados"><MessageSquare size={18}/></button>
                                <button onClick={() => onEdit(o)} className="p-2 border rounded text-blue-400 hover:bg-blue-500/10 transition-colors"><Edit2 size={16}/></button>
                                <button onClick={() => onDelete(o.id)} className="p-2 border rounded text-red-500 hover:bg-red-500/10 transition-colors"><Trash2 size={16}/></button>
                              </div>
                            </td>
                          </tr>
                        ))
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          );
        }

        // --- Componente: Formulário ---
        function OrderForm({ initialData, onSave, onCancel, currentUserProfile, layoutMode }) {
          const [formData, setFormData] = useState({
            maintainer: '', branch: '', orderNumber: '', supplier: '', 
            value: '', status: 'ag. aprovação', type: 'Produto', notes: '', userProfile: currentUserProfile
          });

          useEffect(() => { if(initialData) setFormData({...initialData}); }, [initialData]);

          const inputClass = layoutMode === 'gaming' 
            ? 'bg-slate-950 border-slate-700 text-white focus:border-cyan-400' 
            : 'bg-slate-50 border-slate-200 text-slate-900 focus:bg-white focus:border-blue-400';

          return (
            <div className={`max-w-2xl mx-auto overflow-hidden animate-in zoom-in duration-300 ${layoutMode === 'gaming' ? 'game-card' : 'trad-card'}`}>
              <div className={`p-5 border-b flex justify-between items-center ${layoutMode === 'gaming' ? 'bg-slate-900 border-cyan-500/20' : 'bg-slate-50'}`}>
                <h2 className={`text-xl font-black uppercase tracking-widest ${layoutMode === 'gaming' ? 'neon-text-blue text-white' : 'text-slate-800'}`}>
                    {initialData ? 'Sincronizar Dados' : 'Inserir Nova Missão'}
                </h2>
                <button onClick={onCancel} className="p-2 text-slate-400 hover:text-red-500"><X/></button>
              </div>
              <form onSubmit={e => { e.preventDefault(); onSave(formData); }} className="p-8 space-y-6">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                  <div className="space-y-1">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Mantenedora</label>
                    <input list="m-list" className={`w-full p-3 border rounded font-bold uppercase outline-none transition-all ${inputClass}`} value={formData.maintainer} onChange={e => setFormData({...formData, maintainer: e.target.value})} /><datalist id="m-list">{LISTA_MANTENEDORAS.map(m => <option key={m} value={m}/>)}</datalist>
                  </div>
                  <div className="space-y-1">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Filial / Base</label>
                    <input list="f-list" className={`w-full p-3 border rounded font-bold uppercase outline-none transition-all ${inputClass}`} value={formData.branch} onChange={e => setFormData({...formData, branch: e.target.value})} /><datalist id="f-list">{LISTA_FILIAIS.map(f => <option key={f} value={f}/>)}</datalist>
                  </div>
                  <div className="space-y-1">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Identificador Pedido</label>
                    <input className={`w-full p-3 border rounded font-bold outline-none transition-all ${inputClass}`} value={formData.orderNumber} onChange={e => setFormData({...formData, orderNumber: e.target.value})} required />
                  </div>
                  <div className="space-y-1">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Fornecedor / Unidade</label>
                    <input className={`w-full p-3 border rounded font-bold uppercase outline-none transition-all ${inputClass}`} value={formData.supplier} onChange={e => setFormData({...formData, supplier: e.target.value})} />
                  </div>
                  <div className="space-y-1">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Créditos (R$)</label>
                    <input type="number" step="0.01" className={`w-full p-3 border rounded font-black text-xl outline-none transition-all ${inputClass}`} value={formData.value} onChange={e => setFormData({...formData, value: e.target.value})} required />
                  </div>
                  <div className="space-y-1">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Categoria</label>
                    <div className={`flex gap-2 p-1 rounded border ${layoutMode === 'gaming' ? 'bg-black/40 border-slate-800' : 'bg-slate-100 border-slate-200'}`}>
                        <button type="button" onClick={() => setFormData({...formData, type: 'Produto'})} className={`flex-1 py-2 rounded text-xs font-black transition-all ${formData.type === 'Produto' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-500'}`}>Produto</button>
                        <button type="button" onClick={() => setFormData({...formData, type: 'Serviço'})} className={`flex-1 py-2 rounded text-xs font-black transition-all ${formData.type === 'Serviço' ? 'bg-orange-600 text-white shadow-lg' : 'text-slate-500'}`}>Serviço</button>
                    </div>
                  </div>
                </div>
                <div className="space-y-1 text-center">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Estado da Missão</label>
                    <div className="flex flex-wrap justify-center gap-2 mt-2">
                        {['aprovado', 'enviado', 'ag. aprovação', 'aguardando justificativa', 'reprovado Enio'].map(s => (
                            <button key={s} type="button" onClick={() => setFormData({...formData, status: s})} className={`px-3 py-2 rounded border text-[9px] font-black uppercase transition-all ${
                                formData.status === s 
                                ? (layoutMode === 'gaming' ? 'bg-white text-slate-900 border-white' : 'bg-slate-800 text-white') 
                                : (layoutMode === 'gaming' ? 'bg-slate-900 text-slate-500 border-slate-800' : 'bg-white text-slate-400 border-slate-200')
                            }`}>{s}</button>
                        ))}
                    </div>
                </div>
                <div className="space-y-1">
                    <label className="text-xs font-black uppercase tracking-widest text-slate-500">Notas Operacionais</label>
                    <textarea className={`w-full p-3 border rounded outline-none resize-none transition-all ${inputClass}`} rows="2" value={formData.notes} onChange={e => setFormData({...formData, notes: e.target.value})} />
                </div>
                <div className={`flex gap-4 pt-6 border-t ${layoutMode === 'gaming' ? 'border-slate-800/20' : 'border-slate-100'}`}>
                    <button type="button" onClick={onCancel} className="flex-1 py-4 font-black uppercase tracking-widest text-slate-400 hover:text-red-500">Descartar</button>
                    <button type="submit" className={`flex-[2] py-4 rounded-lg font-black uppercase tracking-widest shadow-xl flex items-center justify-center gap-2 transition-all ${
                        layoutMode === 'gaming' ? 'bg-cyan-600 text-white btn-game' : 'bg-blue-600 text-white hover:bg-blue-700'
                    }`}><Save size={20}/> Gravar Lançamento</button>
                </div>
              </form>
            </div>
          );
        }

        // --- Relatório ---
        function ReportModal({ orders, onClose, layoutMode }) {
          const total = orders.reduce((acc, curr) => acc + (curr.status === 'reprovado Enio' ? 0 : parseFloat(curr.value || 0)), 0);
          return (
            <div className={`fixed inset-0 z-[100] overflow-y-auto ${layoutMode === 'gaming' ? 'bg-slate-950 text-white' : 'bg-white text-slate-900'}`}>
              <div className="p-8 max-w-5xl mx-auto">
                <div className="flex justify-between items-center mb-10 print:hidden border-b pb-6">
                  <h2 className="text-3xl font-black uppercase tracking-tighter">Relatório de Missão</h2>
                  <div className="flex gap-4">
                    <button onClick={() => window.print()} className="bg-slate-800 text-white px-6 py-2 rounded font-black uppercase flex items-center gap-2"><Printer size={18}/> Imprimir</button>
                    <button onClick={onClose} className="bg-red-500 text-white px-6 py-2 rounded font-black uppercase">Fechar HUD</button>
                  </div>
                </div>
                <div className="border border-slate-700/30 rounded-lg overflow-hidden">
                    <table className="w-full text-xs text-left border-collapse">
                      <thead>
                        <tr className="bg-slate-800 text-white font-black uppercase tracking-widest border-b border-slate-700">
                            <th className="py-4 px-3">Sync Data</th>
                            <th className="py-4 px-3">Missão ID</th>
                            <th className="py-4 px-3">Base / Filial</th>
                            <th className="py-4 px-3">Status</th>
                            <th className="py-4 px-3 text-right">Créditos (R$)</th>
                        </tr>
                      </thead>
                      <tbody>
                        {orders.map(o => (
                            <tr key={o.id} className="border-b border-slate-800/10">
                                <td className="py-3 px-3">{new Intl.DateTimeFormat('pt-BR').format(o.createdAt)}</td>
                                <td className="py-3 px-3 font-black">#{o.orderNumber}</td>
                                <td className="py-3 px-3 uppercase text-blue-500">{o.branch}</td>
                                <td className="py-3 px-3 uppercase text-[10px]">{o.status}</td>
                                <td className="py-3 px-3 text-right font-black">{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(o.value)}</td>
                            </tr>
                        ))}
                      </tbody>
                      <tfoot>
                        <tr className="bg-black/5 font-black text-lg">
                            <td colSpan="4" className="py-6 text-right px-6 uppercase tracking-widest opacity-50">Total Sincronizado:</td>
                            <td className="py-6 text-right px-3 text-emerald-600">{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(total)}</td>
                        </tr>
                      </tfoot>
                    </table>
                </div>
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
